<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pickup Display</title>
<style>
  :root{ --bg:#060a0f; --fg:#eaf2ff; --muted:#9bb0c7; }
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{padding:18px}
  h1{margin:0 0 10px 0;font-size:22px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
  .card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:16px;text-align:center}
  .name{font-size:22px;font-weight:700}
  .muted{color:var(--muted);font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Ready for Pickup</h1>
  <div id="grid" class="grid"></div>
  <div id="empty" class="muted" style="padding:12px;display:none">No ready orders right now.</div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
<script>
const config = { apiKey:"AIzaSyBu-Ux4lvGn6-pnBngmJzL0BAtW1uIfOKM", authDomain:"churchfestivalpos.firebaseapp.com", projectId:"churchfestivalpos" };
firebase.initializeApp(config);
const db = firebase.firestore();

const grid = document.getElementById('grid');
const empty = document.getElementById('empty');

function visible(o){
  if (o.status === 'refunded') return false;
  if (o.archived === true) return false;
  return true;
}
function isReady(o){
  if (o.status === 'ready') return true;
  const items = Array.isArray(o.items)?o.items:[];
  return items.length && items.every(it=> !!it.ready );
}

let unsub=null;
function start(){
  if (unsub) unsub();
  unsub = db.collection('orders').orderBy('createdAt','desc').limit(400).onSnapshot(snap=>{
    const rows = snap.docs.map(d=>({ id:d.id, ...d.data() })).filter(o=> visible(o) && isReady(o) );
    grid.innerHTML = '';
    if (!rows.length){ empty.style.display='block'; return; }
    empty.style.display='none';
    rows.forEach(o=>{
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `<div class="name">${o.customer||'—'}</div><div class="muted">#${o.number??'—'}</div>`;
      grid.appendChild(div);
    });
  });
}
start();
</script>
</body>
</html>
