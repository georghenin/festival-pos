<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Menu Importer (Name + Price)</title>

  <style>
    :root{--bg:#0d0f13;--fg:#f5f7fa;--muted:#95a0ad;--accent:#5b9bff;--ok:#2fd28f;--warn:#ffb020;--danger:#ff6b6b;--card:#0f141e;--border:#1b2230}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:#f5f7fa;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .container{max-width:900px;margin:0 auto;padding:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .card{background:#0f141e;border:1px solid var(--border);border-radius:16px;padding:14px}
    .btn{border:none;border-radius:12px;padding:12px 14px;color:#fff;background:#5b9bff;font:inherit;cursor:pointer}
    .btn.ok{background:#2fd28f} .btn.warn{background:#ffb020} .btn.danger{background:#ff6b6b} .btn.gray{background:#1e2432;color:#e5e8ee}
    textarea,input,select{font:inherit;background:#121826;color:#eaf0f6;border:1px solid var(--border);border-radius:12px;padding:12px 14px}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    td,th{border-bottom:1px solid var(--border);padding:8px;text-align:left}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#0f1420;color:#95a0ad;font-size:12px}
    .small{font-size:12px;color:#95a0ad}
    .title{margin:0 0 8px 0}
  </style>

</head>
<body>
<div class="container">
  <h2 class="title">Menu Importer (Name + Price)</h2>
  <div class="row" style="justify-content:space-between">
    <div class="pill" id="me">Not signed in</div>
  </div>

  <div class="card" style="margin-top:10px">
    <p class="small">Paste one item per line. Format can be either:</p>
    <ul class="small">
      <li><code>Name,Price</code> (comma)</li>
      <li><code>Name - Price</code> (dash)</li>
    </ul>
    <p class="small">Examples:</p>
    <pre class="small">Gyro,12
Fries,5
Water - 2</pre>
    <textarea id="txt" placeholder="Paste items here..." style="width:100%;min-height:220px"></textarea>

    <div class="row" style="margin-top:12px">
      <input id="cat" placeholder="Default Category (e.g., Grill)" style="flex:1;min-width:180px">
      <input id="station" placeholder="Default Station (e.g., Grill/Fryer/Drinks/Pizza)" style="flex:1;min-width:220px">
      <input id="startSort" type="number" value="10" style="width:120px" title="Starting sort"> 
      <input id="stepSort" type="number" value="10" style="width:120px" title="Sort step">
      <label class="row" style="gap:6px"><input id="active" type="checkbox" checked> Active</label>
    </div>

    <div class="row" style="margin-top:12px">
      <button id="preview" class="btn">Preview</button>
      <button id="import" class="btn ok" disabled>Import to Firestore</button>
      <button id="clear" class="btn danger">Clear menu (danger)</button>
      <span id="msg" class="small"></span>
    </div>
  </div>

  <div id="tableWrap" class="card" style="margin-top:12px;display:none">
    <table id="table"><thead></thead><tbody></tbody></table>
  </div>
</div>


  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>

<script>

const FIREBASE_CONFIG = {
  apiKey: "AIzaSyBu-Ux4lvGn6-pnBngmJzL0BAtW1uIfOKM",
  authDomain: "churchfestivalpos.firebaseapp.com",
  projectId: "churchfestivalpos",
  storageBucket: "churchfestivalpos.firebasestorage.app",
  messagingSenderId: "447909610900",
  appId: "1:447909610900:web:a54a828bacfa02e7883b81"
};

const ADMIN_EMAILS = ["smsmofri@gmail.com","george.henin98@gmail.com"];

firebase.initializeApp(FIREBASE_CONFIG);
const db=firebase.firestore(); const auth=firebase.auth();

const me=document.getElementById('me'); const msg=document.getElementById('msg');
const txt=document.getElementById('txt'); const cat=document.getElementById('cat'); const station=document.getElementById('station');
const startSort=document.getElementById('startSort'); const stepSort=document.getElementById('stepSort'); const active=document.getElementById('active');
const preview=document.getElementById('preview'); const imp=document.getElementById('import'); const clearBtn=document.getElementById('clear');
const tableWrap=document.getElementById('tableWrap'); const thead=document.querySelector('#table thead'); const tbody=document.querySelector('#table tbody');

auth.onAuthStateChanged(function(u){
  if(!u){
    const email=prompt("Admin email");
    const pass=prompt("Password");
    if(email&&pass){ auth.signInWithEmailAndPassword(email,pass).catch(e=>alert(e.message)); }
    return;
  }
  me.textContent=u.email;
  if(ADMIN_EMAILS.indexOf(u.email)===-1){ alert("Warning: this tool is for admins only."); }
});

function parseLines(text){
  const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
  const out=[]; const catDefault=cat.value.trim(); const stDefault=station.value.trim();
  const start=parseInt(startSort.value||'10',10)||10; const step=parseInt(stepSort.value||'10',10)||10;
  let idx=0;
  for(const line of lines){
    let name='', priceStr='';
    if(line.includes(',')){ const parts=line.split(','); name=parts[0]; priceStr=parts.slice(1).join(','); }
    else if(line.includes(' - ')){ const parts=line.split(' - '); name=parts[0]; priceStr=parts.slice(1).join(' - '); }
    else if(line.includes('-')){ const parts=line.split('-'); name=parts.slice(0,-1).join('-'); priceStr=parts.slice(-1)[0]; }
    else { continue; }
    name = (name||'').trim();
    priceStr = (priceStr||'').trim().replace(/\$/g,'');
    const price = parseFloat(priceStr);
    if(!name || isNaN(price)) continue;
    out.push({
      cat: catDefault || 'General',
      name: name, price: price,
      station: stDefault || 'Grill',
      sort: start + (idx++)*step,
      active: !!active.checked
    });
  }
  return out;
}

let data=[];
preview.onclick=function(){
  try{
    data = parseLines(txt.value);
    if(!data.length) throw new Error('No valid lines found.');
    thead.innerHTML = '<tr><th>cat</th><th>name</th><th>price</th><th>station</th><th>sort</th><th>active</th></tr>';
    tbody.innerHTML = data.map(d=>`<tr><td>${d.cat}</td><td>${d.name}</td><td>${d.price}</td><td>${d.station}</td><td>${d.sort}</td><td>${d.active}</td></tr>`).join('');
    tableWrap.style.display='block'; imp.disabled=false; msg.textContent='Preview OK: '+data.length+' items.';
  }catch(e){
    msg.textContent=e.message; imp.disabled=true; tableWrap.style.display='none';
  }
};

imp.onclick= async function(){
  if(!auth.currentUser || ADMIN_EMAILS.indexOf(auth.currentUser.email)===-1){ alert('Not an admin.'); return; }
  if(!confirm('Import '+data.length+' items into menu?')) return;
  imp.disabled=true; msg.textContent='Importing...';
  try{
    const batchSize = 400;
    for(let i=0;i<data.length;i+=batchSize){
      const batch=db.batch();
      data.slice(i,i+batchSize).forEach(rec=>{ const ref=db.collection('menu').doc(); batch.set(ref, rec); });
      await batch.commit();
    }
    msg.textContent = 'Import complete: '+data.length+' items.';
  }catch(e){ msg.textContent=e.message; }
  imp.disabled=false;
};

clearBtn.onclick= async function(){
  if(!auth.currentUser || ADMIN_EMAILS.indexOf(auth.currentUser.email)===-1){ alert('Not an admin.'); return; }
  if(!confirm('Delete ALL items from menu? This cannot be undone.')) return;
  msg.textContent='Clearing menu...';
  const snap = await db.collection('menu').get();
  const batch = db.batch();
  snap.forEach(d=> batch.delete(db.collection('menu').doc(d.id)));
  await batch.commit();
  msg.textContent='Menu cleared.';
};
</script>
</body></html>
